<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas OS Launcher</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --primary-color: #1a73e8;
            --secondary-color: #34a853;
            --background-color: #202124;
            --taskbar-color: #2d2e30;
            --window-color: #303134;
            --text-color: #e8eaed;
            --accent-color: #8ab4f8;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
        }
        
        /* Custom Cursor */
        body, .app-icon, button, .taskbar-item {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23e8eaed" d="M3.5 3.5L8.5 8.5L10 7L7 10L8.5 11.5L11.5 8.5L10 7L17 14L14 17L15.5 18.5L18.5 15.5L17 14L20.5 20.5H3.5V3.5Z"/></svg>') 12 12, auto;
        }
        
        /* Desktop Area */
        .desktop {
            height: calc(100vh - 60px);
            width: 100vw;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            background-image: linear-gradient(rgba(32, 33, 36, 0.8), rgba(32, 33, 36, 0.9)), url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }
        
        /* Taskbar */
        .taskbar {
            height: 60px;
            width: 100vw;
            background-color: var(--taskbar-color);
            position: absolute;
            bottom: 0;
            left: 0;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .taskbar-left {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .start-button {
            background-color: transparent;
            border: none;
            color: var(--text-color);
            font-size: 14px;
            padding: 10px 15px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .start-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .start-button .material-symbols-rounded {
            font-size: 24px;
        }
        
        .taskbar-center {
            flex: 2;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 5px;
            overflow-x: auto;
            padding: 0 10px;
            height: 100%;
            scrollbar-width: none;
        }
        
        .taskbar-center::-webkit-scrollbar {
            display: none;
        }
        
        .taskbar-item {
            height: 45px;
            min-width: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            padding: 0 10px;
            background-color: transparent;
            border: none;
            color: var(--text-color);
            transition: background-color 0.2s;
            font-size: 12px;
            gap: 8px;
        }
        
        .taskbar-item.active {
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        .taskbar-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .taskbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .time-display {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .time-display:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .time {
            font-size: 14px;
            font-weight: 500;
        }
        
        .date {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Startup Panel */
        .startup-panel {
            position: absolute;
            bottom: 65px;
            left: 20px;
            width: 500px;
            height: 500px;
            background-color: var(--window-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            overflow: hidden;
        }
        
        .startup-panel.active {
            display: grid;
        }
        
        .startup-search {
            grid-column: 1 / -1;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            font-size: 14px;
        }
        
        .startup-apps {
            padding: 20px;
            overflow-y: auto;
        }
        
        .startup-pinned {
            padding: 20px;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
        }
        
        .startup-footer {
            grid-column: 1 / -1;
            padding: 15px 20px;
            background-color: rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .power-buttons {
            display: flex;
            gap: 10px;
        }
        
        .power-button {
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .power-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Clock Panel */
        .clock-panel {
            position: absolute;
            bottom: 65px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background-color: var(--window-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .clock-panel.active {
            display: flex;
        }
        
        .clock-display {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .clock-time {
            font-size: 32px;
            font-weight: 300;
        }
        
        .clock-date {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .notifications {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        
        .notification-item.unread {
            background-color: rgba(26, 115, 232, 0.1);
        }
        
        .notification-icon {
            font-size: 20px;
            color: var(--accent-color);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .notification-text {
            font-size: 12px;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .notification-time {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
        }
        
        .notification-actions {
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Desktop Apps */
        .desktop-apps {
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-content: flex-start;
        }
        
        .app-icon {
            width: 80px;
            height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            padding: 10px;
            transition: all 0.2s;
            position: absolute;
            cursor: pointer;
        }
        
        .app-icon:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .app-icon.dragging {
            opacity: 0.7;
            z-index: 100;
        }
        
        .app-icon .material-symbols-rounded {
            font-size: 32px;
            margin-bottom: 8px;
            color: var(--accent-color);
        }
        
        .app-name {
            font-size: 12px;
            text-align: center;
            word-break: break-word;
        }
        
        /* Right Click Menu */
        .context-menu {
            position: absolute;
            background-color: var(--window-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 2000;
            display: none;
            flex-direction: column;
            min-width: 180px;
            overflow: hidden;
        }
        
        .context-menu.active {
            display: flex;
        }
        
        .context-item {
            padding: 10px 15px;
            border: none;
            background: none;
            color: var(--text-color);
            text-align: left;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s;
        }
        
        .context-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .context-item .material-symbols-rounded {
            font-size: 18px;
        }
        
        .divider {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
            width: 100%;
        }
        
        /* System Notifications */
        .system-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--window-color);
            border-radius: var(--border-radius);
            padding: 15px 20px;
            box-shadow: var(--shadow);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }
        
        .system-notification.show {
            transform: translateX(0);
        }
        
        /* Empty State */
        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0.5;
        }
        
        .empty-state .material-symbols-rounded {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .startup-panel {
                width: 90vw;
                left: 5vw;
            }
            
            .clock-panel {
                width: 90vw;
                right: 5vw;
            }
        }
    </style>
</head>
<body>
    <!-- Desktop Area -->
    <div class="desktop" id="desktop">
        <div class="desktop-apps" id="desktopApps">
            <!-- Apps will be dynamically added here -->
        </div>
        
        <!-- Empty State -->
        <div class="empty-state" id="emptyState">
            <span class="material-symbols-rounded">desktop_windows</span>
            <p>No apps installed. Use Settings to add apps.</p>
        </div>
    </div>
    
    <!-- Taskbar -->
    <div class="taskbar">
        <div class="taskbar-left">
            <button class="start-button" id="startButton">
                <span class="material-symbols-rounded">home</span>
                <span>Start</span>
            </button>
        </div>
        
        <div class="taskbar-center" id="taskbarCenter">
            <!-- Running apps will appear here -->
        </div>
        
        <div class="taskbar-right">
            <div class="time-display" id="timeDisplay">
                <div class="time" id="currentTime">00:00 AM</div>
                <div class="date" id="currentDate">Mon, Jan 1</div>
            </div>
        </div>
    </div>
    
    <!-- Startup Panel -->
    <div class="startup-panel" id="startupPanel">
        <div class="startup-search">
            <input type="text" class="search-input" id="appSearch" placeholder="Search apps and tools...">
        </div>
        
        <div class="startup-apps">
            <h3 style="margin-bottom: 15px; font-size: 16px;">All Apps</h3>
            <div id="allAppsList">
                <!-- All apps will be dynamically added here -->
            </div>
        </div>
        
        <div class="startup-pinned">
            <h3 style="margin-bottom: 15px; font-size: 16px;">Pinned Tools</h3>
            <div id="pinnedAppsList">
                <!-- Pinned apps will be dynamically added here -->
            </div>
        </div>
        
        <div class="startup-footer">
            <div class="user-info">
                <span class="material-symbols-rounded" style="vertical-align: middle; margin-right: 8px;">account_circle</span>
                <span>Atlas User</span>
            </div>
            <div class="power-buttons">
                <button class="power-button" id="restartButton">
                    <span class="material-symbols-rounded">restart_alt</span>
                    <span>Restart</span>
                </button>
                <button class="power-button" id="shutdownButton">
                    <span class="material-symbols-rounded">power_settings_new</span>
                    <span>Shutdown</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Clock Panel -->
    <div class="clock-panel" id="clockPanel">
        <div class="clock-display">
            <div class="clock-time" id="detailedTime">00:00:00 AM</div>
            <div class="clock-date" id="detailedDate">Monday, January 1, 2023</div>
        </div>
        
        <div class="notifications" id="notificationsList">
            <!-- Notifications will appear here -->
            <div class="notification-item unread">
                <span class="material-symbols-rounded notification-icon">notifications</span>
                <div class="notification-content">
                    <div class="notification-title">Welcome to Atlas OS</div>
                    <div class="notification-text">Your operating system is ready. You can now install apps from the Settings.</div>
                    <div class="notification-time">Just now</div>
                </div>
            </div>
        </div>
        
        <div class="notification-actions">
            <button class="power-button" id="clearNotifications">
                <span class="material-symbols-rounded">delete_sweep</span>
                <span>Clear All</span>
            </button>
            <button class="power-button" id="notificationSettings">
                <span class="material-symbols-rounded">settings</span>
                <span>Settings</span>
            </button>
        </div>
    </div>
    
    <!-- Right Click Context Menu -->
    <div class="context-menu" id="contextMenu">
        <button class="context-item" id="contextOpen">
            <span class="material-symbols-rounded">open_in_new</span>
            <span>Open</span>
        </button>
        <button class="context-item" id="contextPin">
            <span class="material-symbols-rounded">push_pin</span>
            <span>Pin to Start</span>
        </button>
        <div class="divider"></div>
        <button class="context-item" id="contextCut">
            <span class="material-symbols-rounded">content_cut</span>
            <span>Cut</span>
        </button>
        <button class="context-item" id="contextCopy">
            <span class="material-symbols-rounded">content_copy</span>
            <span>Copy</span>
        </button>
        <div class="divider"></div>
        <button class="context-item" id="contextRemove">
            <span class="material-symbols-rounded">remove_circle</span>
            <span>Remove from Desktop</span>
        </button>
        <button class="context-item" id="contextDelete" style="color: #f28b82;">
            <span class="material-symbols-rounded">delete</span>
            <span>Delete</span>
        </button>
    </div>
    
    <!-- System Notification -->
    <div class="system-notification" id="systemNotification">
        <span class="material-symbols-rounded" id="notificationIcon">info</span>
        <div>
            <div id="notificationTitle">Notification</div>
            <div id="notificationMessage">This is a system notification</div>
        </div>
    </div>

    <script>
        // Atlas Launcher Core
        class AtlasLauncher {
            constructor() {
                // Database setup
                this.db = null;
                this.dbName = 'AtlasDB';
                this.dbVersion = 1;
                
                // App data
                this.apps = [];
                this.notifications = [];
                this.runningApps = [];
                
                // UI elements
                this.desktop = document.getElementById('desktop');
                this.desktopApps = document.getElementById('desktopApps');
                this.taskbarCenter = document.getElementById('taskbarCenter');
                this.startupPanel = document.getElementById('startupPanel');
                this.clockPanel = document.getElementById('clockPanel');
                this.contextMenu = document.getElementById('contextMenu');
                
                // Initialize
                this.initDB();
                this.setupEventListeners();
                this.updateTime();
                setInterval(() => this.updateTime(), 1000);
                
                // Default empty state
                this.updateEmptyState();
            }
            
            // Initialize IndexedDB
            initDB() {
                const request = indexedDB.open(this.dbName, this.dbVersion);
                
                request.onerror = (event) => {
                    console.error('Database error:', event.target.error);
                    this.showNotification('Database Error', 'Failed to initialize AtlasDB', 'error');
                };
                
                request.onupgradeneeded = (event) => {
                    this.db = event.target.result;
                    
                    // Create object stores (folders)
                    if (!this.db.objectStoreNames.contains('apps')) {
                        const appStore = this.db.createObjectStore('apps', { keyPath: 'id', autoIncrement: true });
                        appStore.createIndex('name', 'name', { unique: false });
                        appStore.createIndex('pinned', 'pinned', { unique: false });
                    }
                    
                    if (!this.db.objectStoreNames.contains('notifications')) {
                        const notificationStore = this.db.createObjectStore('notifications', { keyPath: 'id', autoIncrement: true });
                        notificationStore.createIndex('app', 'app', { unique: false });
                        notificationStore.createIndex('read', 'read', { unique: false });
                    }
                    
                    if (!this.db.objectStoreNames.contains('appexecute')) {
                        this.db.createObjectStore('appexecute', { keyPath: 'id', autoIncrement: true });
                    }
                    
                    // Add a default notification
                    const transaction = event.target.transaction;
                    const notificationStore = transaction.objectStore('notifications');
                    notificationStore.add({
                        app: 'System',
                        title: 'Welcome to Atlas OS',
                        content: 'Your operating system is ready. You can now install apps from the Settings.',
                        time: new Date().toISOString(),
                        read: false
                    });
                };
                
                request.onsuccess = (event) => {
                    this.db = event.target.result;
                    this.loadApps();
                    this.loadNotifications();
                    this.monitorAppExecute();
                };
            }
            
            // Load apps from database
            loadApps() {
                if (!this.db) return;
                
                const transaction = this.db.transaction(['apps'], 'readonly');
                const store = transaction.objectStore('apps');
                const request = store.getAll();
                
                request.onsuccess = (event) => {
                    this.apps = event.target.result || [];
                    this.renderDesktopApps();
                    this.renderStartupApps();
                    this.updateEmptyState();
                };
            }
            
            // Load notifications from database
            loadNotifications() {
                if (!this.db) return;
                
                const transaction = this.db.transaction(['notifications'], 'readonly');
                const store = transaction.objectStore('notifications');
                const request = store.getAll();
                
                request.onsuccess = (event) => {
                    this.notifications = event.target.result || [];
                    this.renderNotifications();
                };
            }
            
            // Monitor appexecute folder for commands
            monitorAppExecute() {
                if (!this.db) return;
                
                // This would typically use IndexedDB events or polling
                // For this demo, we'll simulate checking for commands
                setInterval(() => {
                    const transaction = this.db.transaction(['appexecute'], 'readonly');
                    const store = transaction.objectStore('appexecute');
                    const request = store.getAll();
                    
                    request.onsuccess = (event) => {
                        const commands = event.target.result || [];
                        commands.forEach(command => {
                            this.executeAppCommand(command);
                            
                            // Remove command after execution
                            const deleteTransaction = this.db.transaction(['appexecute'], 'readwrite');
                            const deleteStore = deleteTransaction.objectStore('appexecute');
                            deleteStore.delete(command.id);
                        });
                    };
                }, 1000);
            }
            
            // Execute commands from apps
            executeAppCommand(command) {
                if (command.script) {
                    try {
                        // Execute the script (in a real scenario, this would be more secure)
                        console.log('Executing app command:', command);
                        
                        // Example: Change wallpaper
                        if (command.script.includes('wallpaper')) {
                            const urlMatch = command.script.match(/url\(['"]([^'"]+)['"]\)/);
                            if (urlMatch) {
                                this.desktop.style.backgroundImage = `linear-gradient(rgba(32, 33, 36, 0.8), rgba(32, 33, 36, 0.9)), url('${urlMatch[1]}')`;
                                this.showNotification('Wallpaper Changed', 'Gallery app updated your wallpaper', 'info');
                            }
                        }
                    } catch (error) {
                        console.error('Error executing app command:', error);
                    }
                }
            }
            
            // Render apps on desktop
            renderDesktopApps() {
                this.desktopApps.innerHTML = '';
                
                this.apps.forEach(app => {
                    if (app.desktopVisible !== false) {
                        const appElement = this.createAppElement(app);
                        this.desktopApps.appendChild(appElement);
                    }
                });
            }
            
            // Render apps in startup panel
            renderStartupApps() {
                const allAppsList = document.getElementById('allAppsList');
                const pinnedAppsList = document.getElementById('pinnedAppsList');
                
                allAppsList.innerHTML = '';
                pinnedAppsList.innerHTML = '';
                
                this.apps.forEach(app => {
                    const appElement = this.createStartupAppElement(app);
                    
                    if (app.pinned) {
                        pinnedAppsList.appendChild(appElement.cloneNode(true));
                    }
                    
                    allAppsList.appendChild(appElement);
                });
            }
            
            // Create desktop app element
            createAppElement(app) {
                const appElement = document.createElement('div');
                appElement.className = 'app-icon';
                appElement.dataset.appId = app.id;
                appElement.style.left = `${app.x || 20}px`;
                appElement.style.top = `${app.y || 20}px`;
                
                appElement.innerHTML = `
                    <span class="material-symbols-rounded">${app.icon || 'apps'}</span>
                    <div class="app-name">${app.name || 'App'}</div>
                `;
                
                // Add event listeners
                appElement.addEventListener('click', (e) => {
                    if (!this.isDragging) {
                        this.openApp(app);
                    }
                });
                
                appElement.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showContextMenu(e, app);
                });
                
                // Drag and drop functionality
                this.makeDraggable(appElement, app);
                
                return appElement;
            }
            
            // Create startup panel app element
            createStartupAppElement(app) {
                const appElement = document.createElement('button');
                appElement.className = 'taskbar-item';
                appElement.style.justifyContent = 'flex-start';
                appElement.style.width = '100%';
                appElement.style.marginBottom = '5px';
                
                appElement.innerHTML = `
                    <span class="material-symbols-rounded">${app.icon || 'apps'}</span>
                    <span>${app.name || 'App'}</span>
                `;
                
                appElement.addEventListener('click', () => {
                    this.openApp(app);
                    this.toggleStartupPanel();
                });
                
                return appElement;
            }
            
            // Make an element draggable
            makeDraggable(element, app) {
                let isDragging = false;
                let offsetX, offsetY;
                
                element.addEventListener('mousedown', (e) => {
                    if (e.button !== 0) return; // Only left click
                    
                    isDragging = true;
                    this.isDragging = true;
                    offsetX = e.clientX - element.offsetLeft;
                    offsetY = e.clientY - element.offsetTop;
                    
                    element.classList.add('dragging');
                    
                    const mouseMoveHandler = (e) => {
                        if (isDragging) {
                            element.style.left = `${e.clientX - offsetX}px`;
                            element.style.top = `${e.clientY - offsetY}px`;
                        }
                    };
                    
                    const mouseUpHandler = () => {
                        isDragging = false;
                        this.isDragging = false;
                        element.classList.remove('dragging');
                        
                        // Save new position to database
                        app.x = parseInt(element.style.left);
                        app.y = parseInt(element.style.top);
                        
                        this.saveApp(app);
                        
                        document.removeEventListener('mousemove', mouseMoveHandler);
                        document.removeEventListener('mouseup', mouseUpHandler);
                    };
                    
                    document.addEventListener('mousemove', mouseMoveHandler);
                    document.addEventListener('mouseup', mouseUpHandler);
                });
            }
            
            // Open an app
            openApp(app) {
                // Add to running apps
                if (!this.runningApps.find(a => a.id === app.id)) {
                    this.runningApps.push(app);
                    this.addToTaskbar(app);
                }
                
                // In a real implementation, this would open the app
                // For this demo, we'll show a notification
                this.showNotification(`Opening ${app.name}`, 'App simulation - in a real OS this would open the app', 'info');
                
                // Activate the app in taskbar
                this.activateTaskbarApp(app.id);
            }
            
            // Add app to taskbar
            addToTaskbar(app) {
                const taskbarItem = document.createElement('button');
                taskbarItem.className = 'taskbar-item';
                taskbarItem.dataset.appId = app.id;
                
                taskbarItem.innerHTML = `
                    <span class="material-symbols-rounded">${app.icon || 'apps'}</span>
                    <span>${app.name || 'App'}</span>
                `;
                
                taskbarItem.addEventListener('click', () => {
                    this.activateTaskbarApp(app.id);
                });
                
                this.taskbarCenter.appendChild(taskbarItem);
                
                // Make taskbar scrollable if too many apps
                if (this.taskbarCenter.children.length > 5) {
                    this.taskbarCenter.style.overflowX = 'auto';
                }
            }
            
            // Activate app in taskbar
            activateTaskbarApp(appId) {
                // Remove active class from all taskbar items
                document.querySelectorAll('.taskbar-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Add active class to clicked app
                const activeItem = document.querySelector(`.taskbar-item[data-app-id="${appId}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                }
            }
            
            // Show context menu
            showContextMenu(e, app) {
                e.preventDefault();
                
                // Position the context menu
                this.contextMenu.style.left = `${e.clientX}px`;
                this.contextMenu.style.top = `${e.clientY}px`;
                this.contextMenu.classList.add('active');
                this.contextMenu.dataset.appId = app.id;
                
                // Update pin button text
                const pinButton = document.getElementById('contextPin');
                pinButton.innerHTML = app.pinned ? 
                    `<span class="material-symbols-rounded">push_pin</span><span>Unpin from Start</span>` :
                    `<span class="material-symbols-rounded">push_pin</span><span>Pin to Start</span>`;
                
                // Close context menu when clicking elsewhere
                const closeMenu = () => {
                    this.contextMenu.classList.remove('active');
                    document.removeEventListener('click', closeMenu);
                };
                
                setTimeout(() => {
                    document.addEventListener('click', closeMenu);
                }, 10);
            }
            
            // Save app to database
            saveApp(app) {
                if (!this.db) return;
                
                const transaction = this.db.transaction(['apps'], 'readwrite');
                const store = transaction.objectStore('apps');
                
                if (app.id) {
                    store.put(app);
                } else {
                    store.add(app);
                }
            }
            
            // Update time display
            updateTime() {
                const now = new Date();
                
                // Time formats
                const time12hr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
                const time24hr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
                const date = now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                const detailedDate = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                
                // Update displays
                document.getElementById('currentTime').textContent = time12hr;
                document.getElementById('currentDate').textContent = date;
                document.getElementById('detailedTime').textContent = time24hr;
                document.getElementById('detailedDate').textContent = detailedDate;
            }
            
            // Render notifications
            renderNotifications() {
                const notificationsList = document.getElementById('notificationsList');
                notificationsList.innerHTML = '';
                
                if (this.notifications.length === 0) {
                    notificationsList.innerHTML = `
                        <div class="notification-item">
                            <span class="material-symbols-rounded notification-icon">notifications_off</span>
                            <div class="notification-content">
                                <div class="notification-title">No notifications</div>
                                <div class="notification-text">You're all caught up!</div>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                this.notifications.slice().reverse().forEach(notification => {
                    const notificationElement = document.createElement('div');
                    notificationElement.className = `notification-item ${notification.read ? '' : 'unread'}`;
                    
                    // Calculate time ago
                    const timeAgo = this.getTimeAgo(new Date(notification.time));
                    
                    notificationElement.innerHTML = `
                        <span class="material-symbols-rounded notification-icon">notifications</span>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title || 'Notification'}</div>
                            <div class="notification-text">${notification.content || ''}</div>
                            <div class="notification-time">${timeAgo}</div>
                        </div>
                    `;
                    
                    // Mark as read on click
                    notificationElement.addEventListener('click', () => {
                        this.markNotificationAsRead(notification.id);
                    });
                    
                    notificationsList.appendChild(notificationElement);
                });
            }
            
            // Calculate time ago
            getTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffSec = Math.floor(diffMs / 1000);
                const diffMin = Math.floor(diffSec / 60);
                const diffHour = Math.floor(diffMin / 60);
                const diffDay = Math.floor(diffHour / 24);
                
                if (diffSec < 60) return 'Just now';
                if (diffMin < 60) return `${diffMin} minute${diffMin > 1 ? 's' : ''} ago`;
                if (diffHour < 24) return `${diffHour} hour${diffHour > 1 ? 's' : ''} ago`;
                if (diffDay < 7) return `${diffDay} day${diffDay > 1 ? 's' : ''} ago`;
                
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
            
            // Mark notification as read
            markNotificationAsRead(notificationId) {
                if (!this.db) return;
                
                const transaction = this.db.transaction(['notifications'], 'readwrite');
                const store = transaction.objectStore('notifications');
                const request = store.get(notificationId);
                
                request.onsuccess = (event) => {
                    const notification = event.target.result;
                    if (notification) {
                        notification.read = true;
                        store.put(notification);
                        this.loadNotifications();
                    }
                };
            }
            
            // Show system notification
            showNotification(title, message, type = 'info') {
                const notification = document.getElementById('systemNotification');
                const icon = document.getElementById('notificationIcon');
                const titleEl = document.getElementById('notificationTitle');
                const messageEl = document.getElementById('notificationMessage');
                
                // Set notification content
                titleEl.textContent = title;
                messageEl.textContent = message;
                
                // Set icon based on type
                const icons = {
                    'info': 'info',
                    'success': 'check_circle',
                    'warning': 'warning',
                    'error': 'error'
                };
                icon.textContent = icons[type] || 'info';
                
                // Show notification
                notification.classList.add('show');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }
            
            // Update empty state visibility
            updateEmptyState() {
                const emptyState = document.getElementById('emptyState');
                const hasApps = this.apps.length > 0;
                emptyState.style.display = hasApps ? 'none' : 'block';
            }
            
            // Toggle startup panel
            toggleStartupPanel() {
                this.startupPanel.classList.toggle('active');
                if (this.startupPanel.classList.contains('active')) {
                    this.clockPanel.classList.remove('active');
                }
            }
            
            // Toggle clock panel
            toggleClockPanel() {
                this.clockPanel.classList.toggle('active');
                if (this.clockPanel.classList.contains('active')) {
                    this.startupPanel.classList.remove('active');
                }
            }
            
            // Setup event listeners
            setupEventListeners() {
                // Start button
                document.getElementById('startButton').addEventListener('click', () => {
                    this.toggleStartupPanel();
                });
                
                // Time display (clock panel)
                document.getElementById('timeDisplay').addEventListener('click', () => {
                    this.toggleClockPanel();
                });
                
                // Close panels when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.startupPanel.contains(e.target) && !document.getElementById('startButton').contains(e.target)) {
                        this.startupPanel.classList.remove('active');
                    }
                    
                    if (!this.clockPanel.contains(e.target) && !document.getElementById('timeDisplay').contains(e.target)) {
                        this.clockPanel.classList.remove('active');
                    }
                });
                
                // Prevent default right-click on desktop
                this.desktop.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    
                    // Show desktop context menu (empty for now)
                    this.contextMenu.style.left = `${e.clientX}px`;
                    this.contextMenu.style.top = `${e.clientY}px`;
                    this.contextMenu.classList.add('active');
                    this.contextMenu.dataset.appId = '';
                    
                    // Update context menu for desktop (different options)
                    document.getElementById('contextOpen').style.display = 'none';
                    document.getElementById('contextPin').style.display = 'none';
                    document.getElementById('contextCut').style.display = 'none';
                    document.getElementById('contextCopy').style.display = 'none';
                    document.getElementById('contextRemove').style.display = 'none';
                    document.getElementById('contextDelete').style.display = 'none';
                    
                    const closeMenu = () => {
                        this.contextMenu.classList.remove('active');
                        document.removeEventListener('click', closeMenu);
                    };
                    
                    setTimeout(() => {
                        document.addEventListener('click', closeMenu);
                    }, 10);
                });
                
                // Context menu actions
                document.getElementById('contextOpen').addEventListener('click', () => {
                    const appId = parseInt(this.contextMenu.dataset.appId);
                    const app = this.apps.find(a => a.id === appId);
                    if (app) {
                        this.openApp(app);
                    }
                    this.contextMenu.classList.remove('active');
                });
                
                document.getElementById('contextPin').addEventListener('click', () => {
                    const appId = parseInt(this.contextMenu.dataset.appId);
                    const app = this.apps.find(a => a.id === appId);
                    if (app) {
                        app.pinned = !app.pinned;
                        this.saveApp(app);
                        this.renderStartupApps();
                        this.showNotification(
                            app.pinned ? 'App Pinned' : 'App Unpinned',
                            `${app.name} has been ${app.pinned ? 'pinned to' : 'unpinned from'} Start`,
                            'info'
                        );
                    }
                    this.contextMenu.classList.remove('active');
                });
                
                document.getElementById('contextRemove').addEventListener('click', () => {
                    const appId = parseInt(this.contextMenu.dataset.appId);
                    const app = this.apps.find(a => a.id === appId);
                    if (app) {
                        app.desktopVisible = false;
                        this.saveApp(app);
                        this.renderDesktopApps();
                        this.showNotification(
                            'App Removed',
                            `${app.name} has been removed from desktop`,
                            'info'
                        );
                    }
                    this.contextMenu.classList.remove('active');
                });
                
                // Power buttons
                document.getElementById('shutdownButton').addEventListener('click', () => {
                    if (confirm('Are you sure you want to shutdown Atlas OS?')) {
                        this.showNotification('Shutting Down', 'Atlas OS is shutting down...', 'info');
                        // In a real OS, this would trigger a shutdown
                    }
                });
                
                document.getElementById('restartButton').addEventListener('click', () => {
                    if (confirm('Are you sure you want to restart Atlas OS?')) {
                        this.showNotification('Restarting', 'Atlas OS is restarting...', 'info');
                        // In a real OS, this would trigger a restart
                    }
                });
                
                // Notification buttons
                document.getElementById('clearNotifications').addEventListener('click', () => {
                    if (!this.db) return;
                    
                    const transaction = this.db.transaction(['notifications'], 'readwrite');
                    const store = transaction.objectStore('notifications');
                    const clearRequest = store.clear();
                    
                    clearRequest.onsuccess = () => {
                        this.notifications = [];
                        this.renderNotifications();
                        this.showNotification('Notifications Cleared', 'All notifications have been cleared', 'info');
                    };
                });
                
                // App search
                document.getElementById('appSearch').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const allApps = document.querySelectorAll('#allAppsList .taskbar-item');
                    
                    allApps.forEach(app => {
                        const appName = app.textContent.toLowerCase();
                        app.style.display = appName.includes(searchTerm) ? 'flex' : 'none';
                    });
                });
                
                // Add some sample apps for demonstration
                this.addSampleApps();
            }
            
            // Add sample apps for demonstration
            addSampleApps() {
                // Only add if no apps exist
                if (this.apps.length > 0) return;
                
                const sampleApps = [
                    { name: 'Settings', icon: 'settings', pinned: true, x: 20, y: 20, desktopVisible: true },
                    { name: 'File Explorer', icon: 'folder', pinned: true, x: 120, y: 20, desktopVisible: true },
                    { name: 'Browser', icon: 'public', pinned: false, x: 220, y: 20, desktopVisible: true },
                    { name: 'Terminal', icon: 'terminal', pinned: false, x: 20, y: 130, desktopVisible: true },
                    { name: 'Text Editor', icon: 'edit_document', pinned: false, x: 120, y: 130, desktopVisible: true },
                    { name: 'Calculator', icon: 'calculate', pinned: true, x: 220, y: 130, desktopVisible: true },
                    { name: 'Gallery', icon: 'photo_library', pinned: false, x: 20, y: 240, desktopVisible: true },
                    { name: 'Music Player', icon: 'music_note', pinned: false, x: 120, y: 240, desktopVisible: true }
                ];
                
                // Add to database
                sampleApps.forEach(app => {
                    this.saveApp(app);
                });
                
                // Reload apps
                setTimeout(() => this.loadApps(), 100);
            }
        }
        
        // Initialize Atlas Launcher when page loads
        window.addEventListener('DOMContentLoaded', () => {
            window.atlasLauncher = new AtlasLauncher();
        });
    </script>
</body>
</html>
