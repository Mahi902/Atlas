<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Atlas OS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Material Symbols (Rounded) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <style>
        /* Custom Cursor */
        body {
            cursor: default;
            overflow: hidden; /* Prevent scrolling */
            user-select: none; /* UI feel */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Scrollbar for panels */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(25, 25, 35, 0.65);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .glass-light {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .icon-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* App Icon Dragging State */
        .dragging {
            opacity: 0.5;
            transform: scale(1.05);
        }

        /* Animations */
        .panel-transition {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen w-screen overflow-hidden relative" oncontextmenu="return false;">

    <!-- Desktop Area -->
    <div id="desktop" class="absolute top-0 left-0 w-full h-[calc(100%-3rem)] z-0" 
         ondragover="allowDrop(event)" ondrop="dropApp(event)">
        
        <!-- Wallpaper (Dynamic via CSS/JS) -->
        <div id="wallpaper" class="absolute inset-0 z-[-1] bg-gradient-to-br from-indigo-900 via-purple-900 to-black"></div>

        <!-- Desktop Apps Container (Dynamic) -->
        <div id="desktop-apps" class="w-full h-full relative">
            <!-- App icons will be injected here -->
        </div>
    </div>

    <!-- Context Menu (Right Click) -->
    <div id="context-menu" class="fixed hidden z-50 glass rounded-lg w-48 py-1 text-sm shadow-xl transform scale-95 opacity-0 transition-opacity duration-100 origin-top-left">
        <button onclick="handleContextAction('open')" class="w-full text-left px-4 py-2 hover:bg-white/10 flex items-center gap-2">
            <span class="material-symbols-rounded text-lg">open_in_new</span> Open
        </button>
        <div class="h-px bg-white/10 my-1"></div>
        <button onclick="handleContextAction('copy')" class="w-full text-left px-4 py-2 hover:bg-white/10 flex items-center gap-2">
            <span class="material-symbols-rounded text-lg">content_copy</span> Copy
        </button>
        <button onclick="handleContextAction('cut')" class="w-full text-left px-4 py-2 hover:bg-white/10 flex items-center gap-2">
            <span class="material-symbols-rounded text-lg">content_cut</span> Cut
        </button>
        <div class="h-px bg-white/10 my-1"></div>
        <button onclick="handleContextAction('remove')" class="w-full text-left px-4 py-2 hover:bg-white/10 flex items-center gap-2 text-yellow-300">
            <span class="material-symbols-rounded text-lg">remove_circle</span> Remove
        </button>
        <button onclick="handleContextAction('delete')" class="w-full text-left px-4 py-2 hover:bg-white/10 flex items-center gap-2 text-red-400">
            <span class="material-symbols-rounded text-lg">delete</span> Delete
        </button>
    </div>

    <!-- Start Menu Panel -->
    <div id="start-menu" class="fixed bottom-14 left-2 w-[32rem] h-[36rem] glass rounded-xl z-40 hidden flex-col panel-transition transform translate-y-4 opacity-0">
        <!-- Search -->
        <div class="p-4 pb-2">
            <div class="glass-light rounded-lg flex items-center px-3 py-2">
                <span class="material-symbols-rounded text-gray-400">search</span>
                <input type="text" placeholder="Search apps, settings, and documents" class="bg-transparent border-none outline-none text-white ml-2 w-full placeholder-gray-400 text-sm">
            </div>
        </div>

        <div class="flex-1 flex overflow-hidden">
            <!-- All Apps List -->
            <div class="w-1/2 p-2 overflow-y-auto border-r border-white/5">
                <div class="text-xs font-semibold text-gray-400 px-3 mb-2 uppercase tracking-wider">All Apps</div>
                <div id="start-menu-apps">
                    <!-- Dynamic App List -->
                    <div class="p-4 text-center text-gray-500 text-sm italic">No apps installed.</div>
                </div>
            </div>

            <!-- Pinned Tools -->
            <div class="w-1/2 p-4 bg-black/20">
                <div class="text-xs font-semibold text-gray-400 mb-4 uppercase tracking-wider">Pinned</div>
                <div class="grid grid-cols-3 gap-4">
                    <!-- Mock Pinned Items -->
                    <div class="flex flex-col items-center gap-1 group cursor-pointer">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg group-hover:bg-blue-500 transition">
                            <span class="material-symbols-rounded">settings</span>
                        </div>
                        <span class="text-xs">Settings</span>
                    </div>
                    <div class="flex flex-col items-center gap-1 group cursor-pointer">
                        <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center shadow-lg group-hover:bg-green-500 transition">
                            <span class="material-symbols-rounded">folder</span>
                        </div>
                        <span class="text-xs">Files</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Bar (User/Power) -->
        <div class="p-3 bg-black/40 flex justify-between items-center rounded-b-xl border-t border-white/10">
            <div class="flex items-center gap-2 px-2">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-pink-500 to-orange-400 flex items-center justify-center text-xs font-bold">U</div>
                <span class="text-sm font-medium">User</span>
            </div>
            <div class="flex gap-2">
                <button title="Restart" class="p-2 hover:bg-white/10 rounded-md transition" onclick="alert('System Restarting...')">
                    <span class="material-symbols-rounded text-lg">restart_alt</span>
                </button>
                <button title="Shutdown" class="p-2 hover:bg-white/10 rounded-md transition text-red-400" onclick="alert('System Shutting Down...')">
                    <span class="material-symbols-rounded text-lg">power_settings_new</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Clock & Notification Panel -->
    <div id="clock-panel" class="fixed bottom-14 right-2 w-80 h-96 glass rounded-xl z-40 hidden flex-col panel-transition transform translate-y-4 opacity-0">
        <div class="p-6 border-b border-white/10 text-center">
            <div id="panel-time" class="text-4xl font-light tracking-tight">12:00</div>
            <div id="panel-date" class="text-blue-200 text-sm mt-1">Monday, January 1</div>
        </div>
        
        <div class="flex-1 overflow-hidden flex flex-col">
            <div class="flex justify-between items-center p-3 px-4">
                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Notifications</span>
                <button onclick="clearNotifications()" class="text-xs text-blue-300 hover:text-white transition">Clear All</button>
            </div>
            
            <div id="notification-list" class="flex-1 overflow-y-auto p-2 space-y-2">
                <!-- Notifications go here -->
                <div class="text-center text-gray-500 text-xs mt-10">No new notifications</div>
            </div>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="absolute bottom-0 left-0 w-full h-12 glass z-50 flex justify-between items-center px-2 select-none">
        
        <!-- Start Button -->
        <div class="flex items-center">
            <button onclick="toggleStartMenu()" class="w-10 h-10 rounded-md hover:bg-white/10 flex items-center justify-center transition active:scale-95 group relative">
                <span class="material-symbols-rounded text-2xl text-blue-400 group-hover:text-blue-300 transition-colors">grid_view</span>
                <div class="absolute -top-1 w-1 h-1 bg-white rounded-full opacity-0 group-hover:opacity-100"></div>
            </button>
        </div>

        <!-- Active Apps / Tabs -->
        <div id="taskbar-apps" class="flex-1 flex justify-center gap-1 mx-4 overflow-x-auto h-full items-center">
            <!-- App instances appear here -->
        </div>

        <!-- System Tray -->
        <div class="flex items-center h-full gap-1">
            <div class="flex items-center gap-1 px-2">
                <span class="material-symbols-rounded text-xs">wifi</span>
                <span class="material-symbols-rounded text-xs">volume_up</span>
                <span class="material-symbols-rounded text-xs">battery_full</span>
            </div>
            
            <!-- Clock Button -->
            <button onclick="toggleClockPanel()" class="h-full px-3 hover:bg-white/10 rounded-md transition flex flex-col justify-center items-end min-w-[70px]">
                <span id="taskbar-time" class="text-sm font-medium leading-none">12:00</span>
                <span id="taskbar-date" class="text-[10px] text-gray-300 leading-none mt-1">10/24/2023</span>
            </button>
        </div>
    </div>

    <!-- Initialization Script -->
    <script>
        // --- Core System State ---
        const System = {
            db: null,
            state: {
                isStartOpen: false,
                isClockOpen: false,
                contextMenuTarget: null, // 'desktop' or appId
                contextTargetId: null,
                apps: [],
                notifications: [],
                runningApps: []
            }
        };

        // --- Utils ---
        const $ = (id) => document.getElementById(id);
        const formatTime = (date) => date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const formatDate = (date) => date.toLocaleDateString([], { weekday: 'long', month: 'long', day: 'numeric' });
        const formatDateShort = (date) => date.toLocaleDateString();

        // --- IndexedDB: AtlasDB ---
        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open("AtlasDB", 1);

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Store for installed apps
                    // Schema: { id, name, icon, url, x, y (desktop position) }
                    if (!db.objectStoreNames.contains("apps")) {
                        db.createObjectStore("apps", { keyPath: "id" });
                    }

                    // Store for notifications
                    // Schema: { id, appName, context, time, read }
                    if (!db.objectStoreNames.contains("notifications")) {
                        db.createObjectStore("notifications", { keyPath: "id", autoIncrement: true });
                    }

                    // Store for IPC (Inter-Process Communication)
                    // Schema: { id: "command", code: "js_code_string", timestamp }
                    if (!db.objectStoreNames.contains("appexecute")) {
                        db.createObjectStore("appexecute", { keyPath: "id" });
                    }
                };

                request.onsuccess = (event) => {
                    System.db = event.target.result;
                    console.log("AtlasDB Initialized");
                    loadApps();
                    loadNotifications();
                    startAppExecuteListener();
                    resolve(System.db);
                };

                request.onerror = (event) => {
                    console.error("AtlasDB Error:", event.target.error);
                    reject(event.target.error);
                };
            });
        };

        // --- Database Operations ---
        const dbOp = (storeName, mode, callback) => {
            if (!System.db) return;
            const transaction = System.db.transaction([storeName], mode);
            const store = transaction.objectStore(storeName);
            const request = callback(store);
            return new Promise((resolve, reject) => {
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        };

        // --- Loader Functions ---
        const loadApps = async () => {
            const apps = await dbOp("apps", "readonly", store => store.getAll());
            System.state.apps = apps || [];
            renderDesktopIcons();
            renderStartMenuApps();
        };

        const loadNotifications = async () => {
            const notifs = await dbOp("notifications", "readonly", store => store.getAll());
            System.state.notifications = notifs || [];
            renderNotifications();
        };

        // --- UI Rendering ---
        const renderDesktopIcons = () => {
            const container = $("desktop-apps");
            container.innerHTML = "";
            
            System.state.apps.forEach(app => {
                const el = document.createElement("div");
                el.className = "absolute flex flex-col items-center gap-1 w-20 p-2 rounded hover:bg-white/10 cursor-pointer transition-colors group";
                // Default position if not set
                el.style.left = (app.x || 10) + "px";
                el.style.top = (app.y || 10) + "px";
                el.draggable = true;
                el.id = `app-${app.id}`;
                el.dataset.id = app.id;
                
                el.innerHTML = `
                    <div class="w-12 h-12 bg-gray-800 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform text-white">
                        <span class="material-symbols-rounded text-3xl">${app.icon || 'apps'}</span>
                    </div>
                    <span class="text-xs text-center font-medium drop-shadow-md line-clamp-2 leading-tight select-none icon-shadow">${app.name}</span>
                `;

                // Drag Events
                el.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData("text/plain", app.id);
                    e.dataTransfer.effectAllowed = "move";
                    el.classList.add('dragging');
                    // Calculate offset to prevent snapping to corner
                    const rect = el.getBoundingClientRect();
                    e.dataTransfer.setData("offsetX", e.clientX - rect.left);
                    e.dataTransfer.setData("offsetY", e.clientY - rect.top);
                });

                el.addEventListener('dragend', () => {
                    el.classList.remove('dragging');
                });

                // Right click
                el.addEventListener('contextmenu', (e) => {
                    e.stopPropagation(); // Don't trigger desktop context menu
                    showContextMenu(e, 'app', app.id);
                });

                // Double click to open
                el.addEventListener('dblclick', () => openApp(app));

                container.appendChild(el);
            });
        };

        const renderStartMenuApps = () => {
            const container = $("start-menu-apps");
            if (System.state.apps.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500 text-sm italic">No apps installed.</div>';
                return;
            }
            container.innerHTML = "";
            System.state.apps.forEach(app => {
                const el = document.createElement("div");
                el.className = "flex items-center gap-3 p-2 hover:bg-white/10 rounded cursor-pointer transition";
                el.onclick = () => { openApp(app); toggleStartMenu(); };
                el.innerHTML = `
                    <div class="w-8 h-8 bg-gray-700 rounded-lg flex items-center justify-center text-white">
                        <span class="material-symbols-rounded text-lg">${app.icon || 'apps'}</span>
                    </div>
                    <span class="text-sm">${app.name}</span>
                `;
                container.appendChild(el);
            });
        };

        const renderNotifications = () => {
            const container = $("notification-list");
            if (System.state.notifications.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 text-xs mt-10">No new notifications</div>';
                return;
            }
            container.innerHTML = "";
            System.state.notifications.forEach(notif => {
                const el = document.createElement("div");
                el.className = "bg-white/5 p-3 rounded hover:bg-white/10 transition border border-white/5 relative group";
                el.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-xs font-bold text-blue-300">${notif.appName || 'System'}</span>
                        <span class="text-[10px] text-gray-400">${new Date(notif.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                    </div>
                    <div class="text-sm text-gray-200">${notif.context}</div>
                    <button onclick="deleteNotification(${notif.id})" class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 text-gray-400 hover:text-white transition">
                        <span class="material-symbols-rounded text-sm">close</span>
                    </button>
                `;
                container.appendChild(el);
            });
        };

        // --- Logic: Drag and Drop ---
        const allowDrop = (ev) => {
            ev.preventDefault();
        };

        const dropApp = (ev) => {
            ev.preventDefault();
            const appId = ev.dataTransfer.getData("text/plain");
            if (!appId) return;

            const offsetX = parseInt(ev.dataTransfer.getData("offsetX") || 0);
            const offsetY = parseInt(ev.dataTransfer.getData("offsetY") || 0);

            const x = ev.clientX - offsetX;
            const y = ev.clientY - offsetY;

            // Update local state
            const appIndex = System.state.apps.findIndex(a => a.id.toString() === appId);
            if (appIndex > -1) {
                System.state.apps[appIndex].x = x;
                System.state.apps[appIndex].y = y;

                // Persist to DB
                dbOp("apps", "readwrite", store => store.put(System.state.apps[appIndex]));
                
                // Re-render
                renderDesktopIcons();
            }
        };

        // --- Logic: AppExecute (IPC) ---
        // Simulating the "launcher executes code" requirement
        const startAppExecuteListener = () => {
            // Since IDB events aren't real-time across contexts without complex setup, 
            // we will poll the 'appexecute' table every 2 seconds.
            setInterval(async () => {
                try {
                    const commands = await dbOp("appexecute", "readwrite", store => store.getAll());
                    if (commands && commands.length > 0) {
                        for (const cmd of commands) {
                            console.log("Executing IPC Command:", cmd.id);
                            
                            // DANGEROUS IN REALITY, BUT REQUESTED BY PROMPT
                            try {
                                // Execute the code provided by the app
                                const func = new Function(cmd.code);
                                func();
                            } catch (e) {
                                console.error("IPC Execution Failed:", e);
                            }

                            // Clean up executed command
                            await dbOp("appexecute", "readwrite", store => store.delete(cmd.id));
                        }
                    }
                } catch (err) {
                    console.error("IPC Poll Error", err);
                }
            }, 2000);
        };

        // --- Logic: Notifications ---
        const clearNotifications = async () => {
            const notifs = System.state.notifications;
            for (const n of notifs) {
                await dbOp("notifications", "readwrite", store => store.delete(n.id));
            }
            loadNotifications();
        };
        
        const deleteNotification = async (id) => {
             await dbOp("notifications", "readwrite", store => store.delete(id));
             loadNotifications();
        }

        // --- Logic: UI Toggles ---
        const toggleStartMenu = () => {
            const menu = $("start-menu");
            const clock = $("clock-panel");
            
            if (System.state.isClockOpen) toggleClockPanel();

            if (System.state.isStartOpen) {
                menu.classList.remove("opacity-100", "translate-y-0");
                menu.classList.add("opacity-0", "translate-y-4");
                setTimeout(() => menu.classList.add("hidden"), 200);
            } else {
                menu.classList.remove("hidden");
                // Small delay to allow display:block to apply before opacity transition
                requestAnimationFrame(() => {
                    menu.classList.remove("opacity-0", "translate-y-4");
                    menu.classList.add("opacity-100", "translate-y-0");
                });
            }
            System.state.isStartOpen = !System.state.isStartOpen;
        };

        const toggleClockPanel = () => {
            const menu = $("start-menu");
            const clock = $("clock-panel");
            
            if (System.state.isStartOpen) toggleStartMenu();

            if (System.state.isClockOpen) {
                clock.classList.remove("opacity-100", "translate-y-0");
                clock.classList.add("opacity-0", "translate-y-4");
                setTimeout(() => clock.classList.add("hidden"), 200);
            } else {
                clock.classList.remove("hidden");
                requestAnimationFrame(() => {
                    clock.classList.remove("opacity-0", "translate-y-4");
                    clock.classList.add("opacity-100", "translate-y-0");
                });
            }
            System.state.isClockOpen = !System.state.isClockOpen;
        };

        const updateClock = () => {
            const now = new Date();
            $("taskbar-time").innerText = formatTime(now);
            $("taskbar-date").innerText = formatDateShort(now);
            
            if (System.state.isClockOpen) {
                $("panel-time").innerText = formatTime(now);
                $("panel-date").innerText = formatDate(now);
            }
        };

        // --- Logic: Context Menu ---
        const showContextMenu = (e, type, id = null) => {
            e.preventDefault();
            const menu = $("context-menu");
            
            System.state.contextMenuTarget = type;
            System.state.contextTargetId = id;

            // Position
            let x = e.clientX;
            let y = e.clientY;
            
            // Boundary checks
            if (x + 200 > window.innerWidth) x = window.innerWidth - 200;
            if (y + 250 > window.innerHeight) y = window.innerHeight - 250;

            menu.style.left = `${x}px`;
            menu.style.top = `${y}px`;
            
            menu.classList.remove("hidden");
            requestAnimationFrame(() => {
                menu.classList.remove("opacity-0", "scale-95");
                menu.classList.add("opacity-100", "scale-100");
            });
        };

        const hideContextMenu = () => {
            const menu = $("context-menu");
            menu.classList.remove("opacity-100", "scale-100");
            menu.classList.add("opacity-0", "scale-95");
            setTimeout(() => menu.classList.add("hidden"), 100);
        };

        const handleContextAction = async (action) => {
            const targetId = System.state.contextTargetId;
            const targetType = System.state.contextMenuTarget;
            
            console.log(`Action: ${action} on ${targetType} ${targetId}`);

            if (targetType === 'app' && targetId) {
                const app = System.state.apps.find(a => a.id === targetId);
                
                if (action === 'delete' || action === 'remove') {
                    if(confirm(`Are you sure you want to delete ${app.name}?`)) {
                        await dbOp("apps", "readwrite", store => store.delete(targetId));
                        loadApps();
                    }
                } else if (action === 'open') {
                    openApp(app);
                } else if (action === 'copy') {
                    // Logic to duplicate app entry in DB could go here
                }
            }
            hideContextMenu();
        };

        // --- Logic: App Management (Simulated) ---
        const openApp = (app) => {
            // Since we don't have real app HTML content or iframes setup fully in this prompt scope,
            // We will simulate opening it on the taskbar.
            console.log("Opening app:", app.name);
            
            // Add to running apps if not exists
            if (!System.state.runningApps.includes(app.id)) {
                System.state.runningApps.push(app.id);
                renderTaskbarApps();
            }
            
            // In a real implementation, this would create an iframe or window div
        };

        const renderTaskbarApps = () => {
            const container = $("taskbar-apps");
            container.innerHTML = "";
            
            System.state.runningApps.forEach(appId => {
                const app = System.state.apps.find(a => a.id === appId);
                if (!app) return;

                const btn = document.createElement("button");
                btn.className = "h-10 w-10 flex items-center justify-center rounded hover:bg-white/10 relative group transition";
                btn.innerHTML = `
                    <span class="material-symbols-rounded text-xl text-white shadow-sm">${app.icon}</span>
                    <div class="absolute bottom-1 w-1 h-1 bg-blue-400 rounded-full"></div>
                `;
                btn.onclick = () => alert(`Focusing ${app.name}... (App content not implemented in launcher-only build)`);
                // Right click on taskbar item to close
                btn.oncontextmenu = (e) => {
                    e.preventDefault();
                    if(confirm("Close app?")) {
                        System.state.runningApps = System.state.runningApps.filter(id => id !== appId);
                        renderTaskbarApps();
                    }
                };
                container.appendChild(btn);
            });
        };

        // --- Desktop Interactions ---
        $("desktop").addEventListener("mousedown", (e) => {
            if (e.target.id === "desktop" || e.target.id === "wallpaper") {
                if (System.state.isStartOpen) toggleStartMenu();
                if (System.state.isClockOpen) toggleClockPanel();
            }
        });

        document.addEventListener("click", () => {
            hideContextMenu();
        });

        // Desktop Context Menu
        $("desktop").addEventListener("contextmenu", (e) => {
            if (e.target.id === "desktop" || e.target.id === "wallpaper") {
                // We can show a desktop specific context menu (Properties, Wallpaper etc)
                // For now, prompt implies app-specific context mainly, but we'll reuse generic or suppress default
                e.preventDefault(); 
            }
        });


        // --- Boot ---
        window.onload = () => {
            initDB().then(() => {
                // Developer Note:
                // Uncomment the line below to seed a test app if the DB is empty
                // seedTestApp(); 
            });
            setInterval(updateClock, 1000);
            updateClock();
        };

        // --- Debug/Seeding Helper (Optional) ---
        function seedTestApp() {
            const testApp = {
                id: "settings-app",
                name: "Settings",
                icon: "settings",
                url: "about:blank",
                x: 20,
                y: 20
            };
            dbOp("apps", "readwrite", store => store.put(testApp)).then(loadApps);
            
            const testNotif = {
                appName: "System",
                context: "Welcome to Atlas OS!",
                time: Date.now(),
                read: false
            };
            dbOp("notifications", "readwrite", store => store.put(testNotif)).then(loadNotifications);
        }

    </script>
</body>
</html>
